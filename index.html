<!doctype html>
<html lang="ja" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>高校生を応援する家庭サポートガイド（4:3）</title>
  <style>
    :root {
      --bg: #f5f8ff;
      --bg-accent: radial-gradient(1000px 700px at 70% -20%, rgba(191, 219, 254, 0.45), transparent),
                   radial-gradient(900px 600px at 0% 100%, rgba(221, 214, 254, 0.45), transparent),
                   linear-gradient(180deg, #f8fbff, #edf3ff);
      --page-bg: rgba(255,255,255,0.95);
      --page-border: rgba(99,102,241,0.14);
      --text: #1f2937;
      --muted: #5b6478;
      --accent: #2563eb;
      --accent-2: #8b5cf6;
      --good: #16a34a;
      --warn: #f97316;
      --bad: #dc2626;
      --shadow: 0 18px 42px rgba(148,163,184,.28);
      --card-bg: linear-gradient(180deg, rgba(255,255,255,.96), rgba(242,246,255,.94));
      --card-border: rgba(99,102,241,.18);
      --glass: linear-gradient(180deg, rgba(255,255,255,.9), rgba(224,232,255,.72));
      --progress-track: rgba(99,102,241,.18);
      --radius: 26px;

      --w: min(92vw, 92vh * 4 / 3);
      --h: calc(var(--w) * 3 / 4);
      --pad: clamp(18px, 2.4vw, 36px);

      --h1: clamp(28px, 3.4vw, 46px);
      --h2: clamp(22px, 2.6vw, 34px);
      --h3: clamp(17px, 2vw, 24px);
      --p: clamp(14px, 1.6vw, 19px);
      --small: clamp(12px, 1.3vw, 15px);
      --mono: "SFMono-Regular", Menlo, Consolas, "Liberation Mono", monospace;
    }

    :root[data-theme="dark"]{
      --bg: #0f172a;
      --bg-accent: radial-gradient(1000px 700px at 70% -20%, rgba(56, 189, 248, 0.25), transparent),
                   radial-gradient(900px 600px at 0% 100%, rgba(124, 58, 237, 0.25), transparent),
                   linear-gradient(180deg, #0f172a, #0b1222);
      --page-bg: rgba(15,23,42,0.92);
      --page-border: rgba(148,163,184,0.28);
      --text: #e2e8f0;
      --muted: #94a3b8;
      --accent: #7dd3fc;
      --accent-2: #c4b5fd;
      --shadow: 0 12px 36px rgba(0,0,0,0.45);
      --card-bg: linear-gradient(180deg, rgba(15,23,42,.92), rgba(30,41,59,.92));
      --card-border: rgba(148,163,184,.28);
      --glass: linear-gradient(180deg, rgba(30,41,59,.72), rgba(15,23,42,.76));
      --progress-track: rgba(148,163,184,.24);
    }

    html,body{
      height:100%;
      background: var(--bg);
      background-image: var(--bg-accent);
      color: var(--text);
      margin:0;
      font-family: "Hiragino Sans","Noto Sans JP","Yu Gothic UI","YuGothic","Meiryo", -apple-system, system-ui, "Segoe UI", "Helvetica Neue", Arial, sans-serif;
      letter-spacing:.02em;
    }

    .toolbar{ position: fixed; inset: 18px 18px auto 18px; display:flex; align-items:center; justify-content: space-between; gap:16px; z-index:20; pointer-events:none;}
    .toolbar .left,.toolbar .right{ display:flex; gap:10px; align-items:center; pointer-events:auto;}
    .brand{ display:flex; align-items:center; gap:12px; padding:10px 16px; border-radius:999px; background: var(--glass); border:1px solid var(--page-border); font-weight:600; color:var(--muted); font-size:14px; backdrop-filter: blur(8px);}
    .brand .dot{ width:12px; height:12px; border-radius:50%; background: linear-gradient(135deg, var(--accent), var(--accent-2)); box-shadow: 0 0 0 5px rgba(37,99,235,.15);}
    .kicker{ font-weight:600; color:var(--accent); letter-spacing:.1em; font-size:11px; text-transform: uppercase;}

    .btn{ appearance:none; border:none; outline:none; padding:9px 14px; border-radius:12px; background: var(--glass); border:1px solid var(--page-border); color:var(--text); font-weight:600; font-size:13px; cursor:pointer; transition:.2s transform, .2s filter;}
    .btn:hover{ filter:brightness(1.05);} .btn:active{ transform: translateY(1px);} .btn.primary{ background: linear-gradient(135deg, var(--accent), var(--accent-2)); color:white; border:none;}

    .deck{ width:100%; height:100%; display:grid; place-items:center; padding:80px 0; box-sizing:border-box;}
    .pages{ position:relative; width:var(--w); height:var(--h); border-radius: var(--radius); background: var(--page-bg); border:1px solid var(--page-border); box-shadow: var(--shadow); overflow:hidden; isolation:isolate;}

    .page{ position:absolute; inset:0; display:grid; grid-template-rows:auto 1fr auto; padding: var(--pad); box-sizing:border-box; opacity:0; pointer-events:none; transform: translateX(32px) scale(.98); transition: opacity .35s ease, transform .35s ease;}
    .page.active{ opacity:1; pointer-events:auto; transform: translateX(0) scale(1);}

    .page header{ display:flex; align-items:flex-start; justify-content:space-between; gap:28px; margin-bottom:20px;}
    .page h1{ font-size: var(--h1); line-height:1.2; margin:0;}
    .page h2{ font-size: var(--h2); line-height:1.25; margin:0;}
    .page h3{ font-size: var(--h3); margin:.5em 0 .3em; color: var(--accent);} .lead{ font-size: calc(var(--p)*1.05); color:var(--muted); max-width:52ch;}

    .stack{ display:flex; flex-direction:column; gap: clamp(12px, 1.8vw, 20px); align-items:flex-end;}
    .tag{ display:inline-flex; align-items:center; gap:8px; padding:6px 12px; border-radius:999px; font-size:12px; font-weight:700; letter-spacing:.03em; color:var(--text); background: linear-gradient(135deg, rgba(37,99,235,.16), rgba(139,92,246,.16)); border:1px solid var(--card-border);}
    .tag.q::before{ content:"❓";} .tag.team::before{ content:"🤝";} .tag.voice::before{ content:"💬";} .tag.ai::before{ content:"🤖";}

    .grid-2{ display:grid; grid-template-columns: 1fr 1fr; gap: clamp(16px, 2.6vw, 32px);} .grid-3{ display:grid; grid-template-columns: repeat(3, 1fr); gap: clamp(16px, 2.4vw, 28px);}
    .card{ background: var(--card-bg); border:1px solid var(--card-border); border-radius:20px; padding: clamp(16px, 2.2vw, 22px); box-shadow: inset 0 1px 0 rgba(255,255,255,.7);}
    ul,ol{ margin:.3em 0; padding-left: 1.25em;} li{ margin:.35em 0; font-size: var(--p);} p{ font-size: var(--p); margin:.5em 0;} .note{ font-size: var(--small); color: var(--muted);} .pair{ display:grid; grid-template-columns: 1.05fr 1fr; gap:12px; align-items:start;} .bad{ color: var(--bad); font-weight:700;} .good{ color: var(--good); font-weight:700;}

    .footer{ display:flex; justify-content:space-between; align-items:center; font-size:var(--small); color:var(--muted); margin-top:12px;}
    .progress{ position:absolute; left: var(--pad); right: var(--pad); bottom: 14px; height:4px; background: var(--progress-track); border-radius:999px; overflow:hidden;}
    .progress > i{ display:block; height:100%; width:0%; background: linear-gradient(90deg, var(--accent), var(--accent-2)); }

    .nav{ position:fixed; right:26px; bottom:26px; display:flex; gap:10px; z-index:30; pointer-events:auto;}
    .indicator{ position:fixed; left:24px; bottom:26px; padding:9px 14px; border-radius:12px; background: var(--glass); border:1px solid var(--page-border); font-weight:700; color:var(--muted); z-index:30;}

    /* --- Print fixes --- */
    @page { size: 270mm 202.5mm; margin: 0; }
    @media print{
      body{ background:white; }
      .toolbar, .nav, .indicator{ display:none !important; }
      .deck{ padding:0 !important; }
      .pages{ width:auto !important; height:auto !important; box-shadow:none !important; border:none !important; overflow:visible !important; position:static !important; }
      .page{ position:relative !important; inset:auto !important; opacity:1 !important; transform:none !important; pointer-events:auto !important; break-after:page; page-break-after:always; }
      .progress{ display:none !important; }
      *{ -webkit-print-color-adjust:exact; print-color-adjust:exact; }
    }
  </style>
</head>
<body>
  <div class="toolbar" aria-hidden="false">
    <div class="left">
      <div class="brand"><span class="dot"></span><span>高校生サポート 家庭版</span></div>
      <span class="kicker">4:3 SUPPORT DECK</span>
    </div>
    <div class="right">
      <button class="btn small" id="theme">テーマ切替</button>
      <button class="btn small" id="print">PDFで保存</button>
    </div>
  </div>

  <div class="deck">
    <div class="pages" id="pages" aria-live="polite">
      <!-- 内容は既存のYosukeさん版を前提（省略可）。GitHubの現行index.htmlのままでもOK -->
    </div>
  </div>

  <div class="nav">
    <button class="btn" id="prev">← 前へ</button>
    <button class="btn primary" id="next">次へ →</button>
  </div>
  <div class="indicator" id="indicator">1 / ?</div>

  <script>
    (function(){
      const pages = [...document.querySelectorAll('.page')];
      const indicator = document.getElementById('indicator');
      let idx = 0;
      const bar = () => document.querySelector('.page.active .progress > i');

      function show(i, pushHash = true){
        idx = Math.max(0, Math.min(i, pages.length - 1));
        pages.forEach((p, k) => p.classList.toggle('active', k === idx));
        const b = bar(); if (b) b.style.width = (((idx+1)/pages.length)*100) + '%';
        if(indicator) indicator.textContent = (idx+1) + ' / ' + pages.length;
        if(pushHash) location.hash = '#p' + (idx+1);
        if(pages[idx]) document.title = pages[idx].dataset.title + ' — 高校生サポートガイド';
      }

      function nav(delta){ show(idx + delta); }
      const nx = document.getElementById('next'); if(nx) nx.addEventListener('click', () => nav(1));
      const pv = document.getElementById('prev'); if(pv) pv.addEventListener('click', () => nav(-1));

      window.addEventListener('keydown', (e)=>{
        if (['ArrowRight','KeyD','PageDown','Space'].includes(e.code)) { e.preventDefault(); nav(1); }
        if (['ArrowLeft','KeyA','PageUp'].includes(e.code)) { e.preventDefault(); nav(-1); }
        if (e.code === 'Home') show(0);
        if (e.code === 'End') show(pages.length - 1);
        if (e.key && e.key.toLowerCase() === 't') toggleTheme();
        if (e.key && e.key.toLowerCase() === 'p') window.print();
      });

      function fromHash(){
        const m = location.hash.match(/p(\d+)/i);
        if(m){ const n = parseInt(m[1], 10) - 1; if(!Number.isNaN(n)) show(n, false); }
      }
      window.addEventListener('hashchange', fromHash); fromHash(); show(idx, false);

      function toggleTheme(){
        const root = document.documentElement;
        root.setAttribute('data-theme', root.getAttribute('data-theme') === 'light' ? 'dark' : 'light');
      }
      const th = document.getElementById('theme'); if(th) th.addEventListener('click', toggleTheme);
      const pr = document.getElementById('print'); if(pr) pr.addEventListener('click', () => window.print());

      // ★ Safari対策：印刷直前は全ページをactive化、後で元に戻す
      window.addEventListener('beforeprint', () => {
        document.querySelectorAll('.page').forEach(p => p.classList.add('active'));
      });
      window.addEventListener('afterprint', () => {
        const pages = [...document.querySelectorAll('.page')];
        pages.forEach((p, k) => p.classList.toggle('active', k === idx));
      });
    })();
  </script>
</body>
</html>